<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rita's Cake Costing</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="color-scheme" content="light dark">
  <style>
    :root { color-scheme: light dark; }
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    .section { @apply bg-white/70 dark:bg-zinc-900/60 rounded-2xl shadow p-4; }
    details summary { cursor:pointer; }
  </style>
</head>
<body class="bg-gradient-to-b from-rose-50 to-amber-50 dark:from-zinc-950 dark:to-zinc-900 text-zinc-900 dark:text-zinc-100 min-h-screen">
  <div class="max-w-xl mx-auto p-4 space-y-4">
    <header class="text-center py-3">
      <h1 class="text-2xl font-bold">üç∞ Ritas Kuchenparadies</h1>
      <p class="text-sm opacity-80">Schneller Kostenrechner ‚Äì mobilfreundlich</p>
    </header>

    <!-- Simple Inputs -->
    <section class="section space-y-3">
      <label class="block">Gesamtkosten Zutaten ($)
        <input id="ingredients" type="number" step="0.01" class="mt-1 w-full rounded-xl border border-zinc-300 dark:border-zinc-700 bg-white/60 dark:bg-zinc-800 px-3 py-2" value="18.00" />
      </label>
      <label class="block">St√ºcke / Portionen
        <input id="servings" type="number" step="1" class="mt-1 w-full rounded-xl border border-zinc-300 dark:border-zinc-700 bg-white/60 dark:bg-zinc-800 px-3 py-2" value="12" />
      </label>
      <label class="block">Backzeit (Minuten)
        <input id="bakeMin" type="number" step="1" class="mt-1 w-full rounded-xl border border-zinc-300 dark:border-zinc-700 bg-white/60 dark:bg-zinc-800 px-3 py-2" value="30" />
      </label>
      <div class="flex items-center gap-3">
        <input id="noBake" type="checkbox" class="w-4 h-4" />
        <label for="noBake">No-Bake / K√ºhlschrankkuchen</label>
      </div>
      <div>
        <p class="text-sm font-medium mb-1">Anlass:</p>
        <div class="flex gap-2 flex-wrap">
          <label><input type="radio" name="occasion" value="20" /> Flohmarkt (20%)</label>
          <label><input type="radio" name="occasion" value="30" checked /> Standard (30%)</label>
          <label><input type="radio" name="occasion" value="45" /> Premium (45%)</label>
          <label><input type="radio" name="occasion" value="custom" /> Eigene</label>
        </div>
      </div>
    </section>

    <!-- Results -->
    <section class="section">
      <h2 class="font-semibold mb-2">Ergebnis</h2>
      <div class="mt-3 grid grid-cols-1 sm:grid-cols-3 gap-3 text-center">
        <div class="p-3 rounded-xl bg-sky-100/60 dark:bg-sky-900/40">
          <div class="text-xs opacity-70">Selbstkosten (ohne Marge)</div>
          <div id="costTotalDisplay" class="text-2xl font-bold">$0.00</div>
        </div>
        <div class="p-3 rounded-xl bg-amber-100/60 dark:bg-amber-900/40">
          <div class="text-xs opacity-70">Preis pro Kuchen</div>
          <div id="pricePerCake" class="text-2xl font-bold">$0.00</div>
        </div>
        <div class="p-3 rounded-xl bg-emerald-100/60 dark:bg-emerald-900/40">
          <div class="text-xs opacity-70">Preis pro St√ºck</div>
          <div id="pricePerSlice" class="text-2xl font-bold">$0.00</div>
        </div>
      </div>
      <button id="shareBtn" class="mt-4 w-full rounded-xl bg-zinc-900 text-white dark:bg-white dark:text-zinc-900 py-2 font-semibold">Link mit aktuellen Werten kopieren</button>
    </section>

    <!-- Advanced Details -->
    <details class="section">
      <summary class="font-semibold mb-2">‚öôÔ∏è Details & Optionen</summary>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-2">
        <label class="block">Ofen-Leistung (W)
          <input id="ovenW" type="number" step="50" class="mt-1 w-full rounded-xl border border-zinc-300 dark:border-zinc-700 bg-white/60 dark:bg-zinc-800 px-3 py-2" value="3000" />
        </label>
        <label class="block">Vorheizen (Minuten)
          <input id="preheatMin" type="number" step="1" class="mt-1 w-full rounded-xl border border-zinc-300 dark:border-zinc-700 bg-white/60 dark:bg-zinc-800 px-3 py-2" value="10" />
        </label>
        <label class="block">Strompreis ($/kWh)
          <input id="kwhPrice" type="number" step="0.001" class="mt-1 w-full rounded-xl border border-zinc-300 dark:border-zinc-700 bg-white/60 dark:bg-zinc-800 px-3 py-2" value="0.147" />
        </label>
        <label class="block">Wasser f√ºr Abwasch (Gallonen)
          <input id="waterGal" type="number" step="0.5" class="mt-1 w-full rounded-xl border border-zinc-300 dark:border-zinc-700 bg-white/60 dark:bg-zinc-800 px-3 py-2" value="5" />
        </label>
        <label class="block">Wasserpreis ($/1.000 gal)
          <input id="waterPerThousand" type="number" step="0.01" class="mt-1 w-full rounded-xl border border-zinc-300 dark:border-zinc-700 bg-white/60 dark:bg-zinc-800 px-3 py-2" value="2.00" />
        </label>
        <label class="block">Verpackung pro Kuchen ($)
          <input id="packaging" type="number" step="0.01" class="mt-1 w-full rounded-xl border border-zinc-300 dark:border-zinc-700 bg-white/60 dark:bg-zinc-800 px-3 py-2" value="1.50" />
        </label>
        <label class="block">Fixe Sonstiges / Abnutzung ($)
          <input id="fixedOverhead" type="number" step="0.01" class="mt-1 w-full rounded-xl border border-zinc-300 dark:border-zinc-700 bg-white/60 dark:bg-zinc-800 px-3 py-2" value="1.00" />
        </label>
        <label class="block">Arbeitszeit (Std)
          <input id="laborHours" type="number" step="0.25" class="mt-1 w-full rounded-xl border border-zinc-300 dark:border-zinc-700 bg-white/60 dark:bg-zinc-800 px-3 py-2" value="1.0" />
        </label>
        <label class="block">Stundenlohn ($/Std)
          <input id="laborRate" type="number" step="0.5" class="mt-1 w-full rounded-xl border border-zinc-300 dark:border-zinc-700 bg-white/60 dark:bg-zinc-800 px-3 py-2" value="15" />
        </label>
        <label class="block">Ausschuss / Verschnitt (%)
          <input id="wastePct" type="number" step="1" class="mt-1 w-full rounded-xl border border-zinc-300 dark:border-zinc-700 bg-white/60 dark:bg-zinc-800 px-3 py-2" value="5" />
        </label>
        <label class="block">Marge (%)
          <input id="marginPct" type="number" step="1" class="mt-1 w-full rounded-xl border border-zinc-300 dark:border-zinc-700 bg-white/60 dark:bg-zinc-800 px-3 py-2" value="30" />
        </label>
      </div>
    </details>

    <footer class="py-6 text-center text-xs opacity-70">
      <p>Made with ‚ù§Ô∏è for Rita. Alle Werte frei anpassbar. Diese Seite speichert nichts ‚Äì alles bleibt lokal.</p>
    </footer>
  </div>

<script>
const $ = (id) => document.getElementById(id);
const fields = [
  'ingredients','servings','ovenW','bakeMin','preheatMin','kwhPrice','waterGal','waterPerThousand',
  'packaging','fixedOverhead','laborHours','laborRate','wastePct','marginPct'
];

function kWhCost(ovenW, minutes, price){
  const kWh = (ovenW * (minutes/60)) / 1000; // kWh
  return kWh * price;
}

function waterCost(gal, perThousand){
  return (gal * (perThousand / 1000));
}

function fmt(n){ return n.toLocaleString(undefined,{style:'currency', currency:'USD'}); }

function compute(){
  const v = Object.fromEntries(fields.map(f => [f, parseFloat($(f).value || '0')]));
  const noBake = document.getElementById('noBake').checked;
  const energy = noBake ? 0 : kWhCost(v.ovenW, v.bakeMin + v.preheatMin, v.kwhPrice);
  const water = waterCost(v.waterGal, v.waterPerThousand);
  const labor = v.laborHours * v.laborRate;
  const base = v.ingredients + energy + water + v.packaging + v.fixedOverhead + labor;
  const wasteAdj = base * (v.wastePct/100);
  const costTotal = base + wasteAdj;

  let marginPct = v.marginPct;
  const selectedOccasion = document.querySelector('input[name="occasion"]:checked').value;
  if(selectedOccasion !== 'custom') {
    marginPct = parseFloat(selectedOccasion);
    $('marginPct').value = marginPct;
  }
  const margin = costTotal * (marginPct/100);
  const priceCake = costTotal + margin;
  const perSlice = priceCake / Math.max(1, v.servings);

  document.getElementById('costTotalDisplay').textContent = fmt(costTotal);
  document.getElementById('pricePerCake').textContent = fmt(priceCake);
  document.getElementById('pricePerSlice').textContent = fmt(perSlice);
}

fields.forEach(id => $(id).addEventListener('input', compute));
document.getElementById('noBake').addEventListener('change', compute);
document.querySelectorAll('input[name="occasion"]').forEach(r => r.addEventListener('change', compute));

// Deep-linking via URL params
function loadFromURL(){
  const p = new URLSearchParams(location.search);
  fields.forEach(f => { if(p.has(f)) $(f).value = p.get(f); });
  if(p.has('noBake')) $('noBake').checked = p.get('noBake') === 'true';
  if(p.has('occasion')) {
    const occ = p.get('occasion');
    const el = document.querySelector(`input[name=occasion][value="${occ}"]`);
    if(el) el.checked = true;
  }
}
function shareLink(){
  const p = new URLSearchParams();
  fields.forEach(f => p.set(f, $(f).value));
  p.set('noBake', $('noBake').checked);
  const occ = document.querySelector('input[name="occasion"]:checked').value;
  p.set('occasion', occ);
  const url = `${location.origin}${location.pathname}?${p.toString()}`;
  navigator.clipboard.writeText(url).then(()=>{
    const btn = $('shareBtn');
    const old = btn.textContent; btn.textContent = 'Link kopiert!';
    setTimeout(()=>btn.textContent = old, 1200);
  }).catch(()=>{
    alert(url);
  });
}
$('shareBtn').addEventListener('click', shareLink);

loadFromURL();
compute();
</script>
</body>
</html>
